const describe = require('mocha').describe
const it = require('mocha').it
const expect = require('chai').expect
const encoder = require('../src/encoder.js')

describe('encoder', function () {
  it('should encode set-ip request', function () {
    const controller = 405419896
    const address = '192.168.1.100'
    const netmask = '255.255.255.0'
    const gateway = '192.168.1.1'

    const expected = Buffer.from([
      0x17, 0x96, 0x00, 0x00, 0x78, 0x37, 0x2a, 0x18, 0xc0, 0xa8, 0x01, 0x64, 0xff, 0xff, 0xff, 0x00,
      0xc0, 0xa8, 0x01, 0x01, 0x55, 0xaa, 0xaa, 0x55, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
    ])

    const request = encoder.SetIP(controller, { address, netmask, gateway })

    expect(request).to.deep.equal(expected)
  })

  it('should encode set-listener request', function () {
    const controller = 405419896
    const address = '192.168.1.100'
    const port = 60001
    const interval = 20

    const expected = Buffer.from([
      0x17, 0x90, 0x00, 0x00, 0x78, 0x37, 0x2a, 0x18, 0xc0, 0xa8, 0x01, 0x64, 0x61, 0xea, 0x14, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
    ])

    const request = encoder.SetListener(controller, { address, port, interval })

    expect(request).to.deep.equal(expected)
  })

  it('should encode set-listener request without auto-send interval', function () {
    const controller = 405419896
    const address = '192.168.1.100'
    const port = 60001

    const expected = Buffer.from([
      0x17, 0x90, 0x00, 0x00, 0x78, 0x37, 0x2a, 0x18, 0xc0, 0xa8, 0x01, 0x64, 0x61, 0xea, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
    ])

    const request = encoder.SetListener(controller, { address, port })

    expect(request).to.deep.equal(expected)
  })
})
